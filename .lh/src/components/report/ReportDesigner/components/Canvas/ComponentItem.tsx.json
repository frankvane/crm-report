{
    "sourceFile": "src/components/report/ReportDesigner/components/Canvas/ComponentItem.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1747218782317,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1747218789810,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,6 @@\n-import { useDraggable, useSortable } from \"@dnd-kit/core\";\r\n-\r\n import React from \"react\";\r\n+import { useDraggable } from \"@dnd-kit/core\";\r\n \r\n interface ComponentItemProps {\r\n   component: any;\r\n   selected: boolean;\r\n"
                },
                {
                    "date": 1747218930693,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,10 +6,15 @@\n   selected: boolean;\r\n   onSelect: () => void;\r\n }\r\n \r\n-const ComponentItem: React.FC<ComponentItemProps> = ({ component, selected, onSelect }) => {\r\n-  const { attributes, listeners, setNodeRef, transform, isDragging } = useDraggable({ id: component.id });\r\n+const ComponentItem: React.FC<ComponentItemProps> = ({\r\n+  component,\r\n+  selected,\r\n+  onSelect,\r\n+}) => {\r\n+  const { attributes, listeners, setNodeRef, transform, isDragging } =\r\n+    useDraggable({ id: component.id });\r\n   // 如需排序可用 useSortable({ id: component.id }) 替换\r\n   const style: React.CSSProperties = {\r\n     position: \"absolute\",\r\n     left: component.x,\r\n@@ -23,30 +28,47 @@\n     cursor: isDragging ? \"grabbing\" : \"grab\",\r\n     zIndex: isDragging ? 1000 : 1,\r\n     userSelect: \"none\",\r\n     transition: \"box-shadow 0.2s, border 0.2s\",\r\n-    transform: transform ? `translate3d(${transform.x}px,${transform.y}px,0)` : undefined,\r\n+    transform: transform\r\n+      ? `translate3d(${transform.x}px,${transform.y}px,0)`\r\n+      : undefined,\r\n   };\r\n   return (\r\n     <div\r\n       ref={setNodeRef}\r\n       {...attributes}\r\n       {...listeners}\r\n       style={style}\r\n-      onClick={e => { e.stopPropagation(); onSelect(); }}\r\n+      onClick={(e) => {\r\n+        e.stopPropagation();\r\n+        onSelect();\r\n+      }}\r\n     >\r\n       {/* 组件内容渲染，可根据 type 拓展 */}\r\n       {component.type === \"label\" && (\r\n-        <span style={{ fontWeight: \"bold\", color: component.props?.color || \"#333\" }}>{component.props?.text || \"标签\"}</span>\r\n+        <span\r\n+          style={{\r\n+            fontWeight: \"bold\",\r\n+            color: component.props?.color || \"#333\",\r\n+          }}\r\n+        >\r\n\\ No newline at end of file\n+          {component.props?.text || \"标签\"}\r\n+        </span>\r\n       )}\r\n       {component.type === \"button\" && (\r\n-        <button style={{ width: \"100%\", height: \"100%\" }}>{component.props?.text || \"按钮\"}</button>\r\n+        <button style={{ width: \"100%\", height: \"100%\" }}>\r\n+          {component.props?.text || \"按钮\"}\r\n+        </button>\r\n       )}\r\n       {component.type === \"input\" && (\r\n-        <input style={{ width: \"100%\", height: \"100%\" }} placeholder={component.props?.placeholder || \"输入框\"} />\r\n+        <input\r\n+          style={{ width: \"100%\", height: \"100%\" }}\r\n+          placeholder={component.props?.placeholder || \"输入框\"}\r\n+        />\r\n       )}\r\n       {/* 其它类型... */}\r\n     </div>\r\n   );\r\n };\r\n \r\n-export default ComponentItem;\n+export default ComponentItem;\r\n"
                },
                {
                    "date": 1747227955507,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,5 @@\n- \n\\ No newline at end of file\n+// 单个组件的拖拽/渲染\r\n+\r\n+export default function ComponentItem() {\r\n+  return null;\r\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1747231813290,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,133 @@\n // 单个组件的拖拽/渲染\r\n \r\n-export default function ComponentItem() {\r\n-  return null;\r\n+import React, { useRef } from \"react\";\r\n+\r\n+import { useDraggable } from \"@dnd-kit/core\";\r\n+\r\n+// 示例：Label组件渲染（可根据实际注册表扩展）\r\n+function LabelComponent({ text }: { text: string }) {\r\n+  return <span>{text}</span>;\r\n }\r\n+\r\n+interface ComponentItemProps {\r\n+  comp: any;\r\n+  isSelected: boolean;\r\n+  onSelect: () => void;\r\n+  onResize: (w: number, h: number) => void;\r\n+}\r\n+\r\n+export default function ComponentItem({ comp, isSelected, onSelect, onResize }: ComponentItemProps) {\r\n+  const { attributes, listeners, setNodeRef, transform, isDragging } = useDraggable({ id: comp.id });\r\n+  const resizing = useRef(false);\r\n+  const start = useRef({ x: 0, y: 0, width: 0, height: 0 });\r\n+\r\n+  // 缩放事件\r\n+  const handleResizeMouseDown = (e: React.MouseEvent) => {\r\n+    e.stopPropagation();\r\n+    resizing.current = true;\r\n+    start.current = {\r\n+      x: e.clientX,\r\n+      y: e.clientY,\r\n+      width: comp.width,\r\n+      height: comp.height,\r\n+    };\r\n+    document.addEventListener(\"mousemove\", handleResizing);\r\n+    document.addEventListener(\"mouseup\", handleResizeMouseUp);\r\n+  };\r\n+  const handleResizing = (e: MouseEvent) => {\r\n+    if (!resizing.current) return;\r\n+    const dx = e.clientX - start.current.x;\r\n+    const dy = e.clientY - start.current.y;\r\n+    const newWidth = Math.max(20, start.current.width + dx);\r\n+    const newHeight = Math.max(20, start.current.height + dy);\r\n+    onResize(newWidth, newHeight);\r\n+  };\r\n+  const handleResizeMouseUp = () => {\r\n+    resizing.current = false;\r\n+    document.removeEventListener(\"mousemove\", handleResizing);\r\n+    document.removeEventListener(\"mouseup\", handleResizeMouseUp);\r\n+  };\r\n+\r\n+  // 选中\r\n+  const handleClick = (e: React.MouseEvent) => {\r\n+    e.stopPropagation();\r\n+    if (!resizing.current) {\r\n+      onSelect();\r\n+    }\r\n+  };\r\n+\r\n+  const style: React.CSSProperties = {\r\n+    position: \"absolute\",\r\n+    left: comp.x + (transform?.x || 0),\r\n+    top: comp.y + (transform?.y || 0),\r\n+    width: comp.width,\r\n+    height: comp.height,\r\n+    background: \"#fff\",\r\n+    border: isSelected ? \"2.5px solid #ff9800\" : \"1px solid #1976d2\",\r\n+    borderRadius: 4,\r\n+    display: \"flex\",\r\n+    alignItems: \"center\",\r\n+    justifyContent: \"center\",\r\n+    fontWeight: 500,\r\n+    color: \"#1976d2\",\r\n+    boxShadow: isSelected ? \"0 0 0 3px #ffe0b2\" : \"0 2px 8px #1976d233\",\r\n+    cursor: isDragging ? \"grabbing\" : \"move\",\r\n+    userSelect: \"none\",\r\n+    zIndex: isSelected ? 10 : 1,\r\n+    transition: \"box-shadow 0.2s, border 0.2s\",\r\n+    opacity: isDragging ? 0.7 : 1,\r\n+    overflow: \"visible\",\r\n+  };\r\n+\r\n+  // 根据类型渲染具体组件\r\n+  let content = null;\r\n+  if (comp.type === \"label\") {\r\n+    content = <LabelComponent {...comp.props} />;\r\n+  } else {\r\n+    content = <span>未知组件类型: {comp.type}</span>;\r\n+  }\r\n+\r\n+  return (\r\n+    <div\r\n+      ref={setNodeRef}\r\n+      {...listeners}\r\n+      {...attributes}\r\n+      style={style}\r\n+      onClick={handleClick}\r\n+      tabIndex={0}\r\n+    >\r\n+      {content}\r\n+      {/* 右下角缩放手柄 */}\r\n+      {isSelected && (\r\n+        <div\r\n+          onMouseDown={handleResizeMouseDown}\r\n+          style={{\r\n+            position: \"absolute\",\r\n+            right: -10,\r\n+            bottom: -10,\r\n+            width: 18,\r\n+            height: 18,\r\n+            background: \"#fff\",\r\n+            border: \"2.5px solid #ff9800\",\r\n+            borderRadius: 4,\r\n+            cursor: \"nwse-resize\",\r\n+            zIndex: 99,\r\n+            boxShadow: \"0 2px 8px #1976d233\",\r\n+            display: \"flex\",\r\n+            alignItems: \"center\",\r\n+            justifyContent: \"center\",\r\n+          }}\r\n+        >\r\n+          <div\r\n+            style={{\r\n+              width: 10,\r\n+              height: 10,\r\n+              background: \"#ff9800\",\r\n+              borderRadius: 2,\r\n+            }}\r\n+          />\r\n+        </div>\r\n+      )}\r\n+    </div>\r\n+  );\r\n+}\r\n"
                }
            ],
            "date": 1747218782317,
            "name": "Commit-0",
            "content": "import { useDraggable, useSortable } from \"@dnd-kit/core\";\r\n\r\nimport React from \"react\";\r\n\r\ninterface ComponentItemProps {\r\n  component: any;\r\n  selected: boolean;\r\n  onSelect: () => void;\r\n}\r\n\r\nconst ComponentItem: React.FC<ComponentItemProps> = ({ component, selected, onSelect }) => {\r\n  const { attributes, listeners, setNodeRef, transform, isDragging } = useDraggable({ id: component.id });\r\n  // 如需排序可用 useSortable({ id: component.id }) 替换\r\n  const style: React.CSSProperties = {\r\n    position: \"absolute\",\r\n    left: component.x,\r\n    top: component.y,\r\n    width: component.width,\r\n    height: component.height,\r\n    border: selected ? \"2px solid #1890ff\" : \"1px solid #e5e5e5\",\r\n    background: isDragging ? \"#e6f7ff\" : \"#fff\",\r\n    borderRadius: 6,\r\n    boxShadow: selected ? \"0 0 0 2px #91d5ff\" : undefined,\r\n    cursor: isDragging ? \"grabbing\" : \"grab\",\r\n    zIndex: isDragging ? 1000 : 1,\r\n    userSelect: \"none\",\r\n    transition: \"box-shadow 0.2s, border 0.2s\",\r\n    transform: transform ? `translate3d(${transform.x}px,${transform.y}px,0)` : undefined,\r\n  };\r\n  return (\r\n    <div\r\n      ref={setNodeRef}\r\n      {...attributes}\r\n      {...listeners}\r\n      style={style}\r\n      onClick={e => { e.stopPropagation(); onSelect(); }}\r\n    >\r\n      {/* 组件内容渲染，可根据 type 拓展 */}\r\n      {component.type === \"label\" && (\r\n        <span style={{ fontWeight: \"bold\", color: component.props?.color || \"#333\" }}>{component.props?.text || \"标签\"}</span>\r\n      )}\r\n      {component.type === \"button\" && (\r\n        <button style={{ width: \"100%\", height: \"100%\" }}>{component.props?.text || \"按钮\"}</button>\r\n      )}\r\n      {component.type === \"input\" && (\r\n        <input style={{ width: \"100%\", height: \"100%\" }} placeholder={component.props?.placeholder || \"输入框\"} />\r\n      )}\r\n      {/* 其它类型... */}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ComponentItem;"
        }
    ]
}